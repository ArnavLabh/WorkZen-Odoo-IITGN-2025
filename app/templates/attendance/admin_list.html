{% extends "base.html" %}

{% block title %}Attendance Management - WorkZen{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1 class="card-title">
            <i class="fas fa-calendar-check"></i> Attendance Management
        </h1>
        <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-end;">
            {% if current_user.role in ['Admin', 'HR Officer'] %}
            <a href="{{ url_for('attendance.create', date=filter_date.strftime('%Y-%m-%d')) }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Create Attendance
            </a>
            {% endif %}
            <p class="text-muted" style="margin: 0; font-size: 0.875rem;">
                <i class="fas fa-info-circle"></i> View attendance records for all employees
            </p>
        </div>
    </div>
    
    <!-- Date Navigation and Search -->
    <div class="search-filter-bar" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <a href="{{ url_for('admin_attendance_route', date=prev_date.strftime('%Y-%m-%d')) }}" class="btn btn-secondary">
                <i class="fas fa-chevron-left"></i>
            </a>
            
            <form method="GET" action="{{ url_for('admin_attendance_route') }}" style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="date" name="date" class="form-control" value="{{ filter_date.strftime('%Y-%m-%d') }}" onchange="this.form.submit()" style="max-width: 180px;">
            </form>
            
            <a href="{{ url_for('admin_attendance_route', date=next_date.strftime('%Y-%m-%d')) }}" class="btn btn-secondary">
                <i class="fas fa-chevron-right"></i>
            </a>
        </div>
        
        <form method="GET" action="{{ url_for('admin_attendance_route') }}" style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="hidden" name="date" value="{{ filter_date.strftime('%Y-%m-%d') }}">
            <input type="text" 
                   name="search" 
                   class="form-control" 
                   placeholder="Search by employee name or ID..." 
                   value="{{ search }}"
                   style="min-width: 250px;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
            {% if search %}
            <a href="{{ url_for('admin_attendance_route', date=filter_date.strftime('%Y-%m-%d')) }}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Clear
            </a>
            {% endif %}
        </form>
    </div>
    
    <!-- Attendance Table -->
    <div class="table-container">
        <table class="table" id="data-table">
            <thead>
                <tr>
                    <th>Employee Name</th>
                    <th>Check In</th>
                    <th>Check Out</th>
                    <th>Work Hours</th>
                    <th>Extra Hours</th>
                    {% if current_user.role in ['Admin', 'HR Officer'] %}
                    <th>Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for attendance in attendances %}
                <tr>
                    <td>
                        <strong>{{ attendance.user.name }}</strong><br>
                        <small class="text-muted">{{ attendance.user.employee_id }}</small>
                    </td>
                    <td>{{ attendance.check_in.strftime('%H:%M') if attendance.check_in else '-' }}</td>
                    <td>{{ attendance.check_out.strftime('%H:%M') if attendance.check_out else '-' }}</td>
                    <td>{{ "%.1f"|format(attendance.working_hours) }} hrs</td>
                    <td>
                        {% if attendance.extra_hours > 0 %}
                            <span style="color: #10b981; font-weight: 600;">{{ "%.1f"|format(attendance.extra_hours) }} hrs</span>
                        {% else %}
                            <span style="color: #6b7280;">-</span>
                        {% endif %}
                    </td>
                    {% if current_user.role in ['Admin', 'HR Officer'] %}
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{{ url_for('attendance.edit', attendance_id=attendance.id) }}" class="btn btn-sm btn-outline-primary" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form method="POST" action="{{ url_for('attendance.delete', attendance_id=attendance.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this attendance record?')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                    {% endif %}
                </tr>
                {% else %}
                <tr>
                    <td colspan="{% if current_user.role in ['Admin', 'HR Officer'] %}6{% else %}5{% endif %}" class="text-center">
                        {% if search %}
                            No attendance records found for "{{ search }}" on {{ filter_date.strftime('%B %d, %Y') }}
                        {% else %}
                            No attendance records found for {{ filter_date.strftime('%B %d, %Y') }}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

